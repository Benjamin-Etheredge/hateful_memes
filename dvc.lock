schema: '2.0'
stages:
  test_visual_bert:
    cmd: "python -m hateful_memes.models.visual_bert --batch_size 4  --fast_dev_run\
      \ True --log_dir logs/test_simple_visual_bert_image_metrics --project test &&\
      \ echo \"PASSED\" > logs/test_visual_bert.log \n"
    deps:
    - path: data/01_raw/hateful_memes
      md5: 8844b5201ff55743fcd36c40d7352a88.dir
      size: 4232567214
      nfiles: 12148
    - path: hateful_memes/models/base.py
      md5: d220bbab0083a6d96e8089a2d8027c8d
      size: 6457
    - path: hateful_memes/models/visual_bert.py
      md5: 4b730bb0fda6de7d937a22e5fccb9691
      size: 4658
    outs:
    - path: logs/test_visual_bert.log
      md5: 15de982d1dc99ce52d089868a579de34
      size: 7
  test_simple_image:
    cmd: "python -m hateful_memes.models.simple_image --log_dir logs/test_simple_image_metrics\
      \ --project test --fast_dev_run True && echo \"PASSED\" > logs/test_simple_image.log\n"
    deps:
    - path: data/01_raw/hateful_memes
      md5: 8844b5201ff55743fcd36c40d7352a88.dir
      size: 4232567214
      nfiles: 12148
    - path: hateful_memes/models/base.py
      md5: d220bbab0083a6d96e8089a2d8027c8d
      size: 6457
    - path: hateful_memes/models/simple_image.py
      md5: 668c45dd1299a69736941a808e8bc3af
      size: 3999
    outs:
    - path: logs/test_simple_image.log
      md5: 15de982d1dc99ce52d089868a579de34
      size: 7
  simple_image:
    cmd: "python -m hateful_memes.models.simple_image --batch_size 0 --lr 1e-05 --epochs\
      \ 100 --dense_dim 256 --dropout_rate 0.0 --grad_clip 1.0 --model_dir data/06_models/simple_image\
      \ --batch_norm true\n"
    deps:
    - path: data/01_raw/hateful_memes
      md5: 8844b5201ff55743fcd36c40d7352a88.dir
      size: 4232567214
      nfiles: 12148
    - path: hateful_memes/models/base.py
      md5: d220bbab0083a6d96e8089a2d8027c8d
      size: 6457
    - path: hateful_memes/models/simple_image.py
      md5: 668c45dd1299a69736941a808e8bc3af
      size: 3999
    - path: logs/test_simple_image.log
      md5: 15de982d1dc99ce52d089868a579de34
      size: 7
    outs:
    - path: data/06_models/simple_image
      md5: 67216ae5d938dcd9455b6bf47e8deb3d.dir
      size: 25186127
      nfiles: 1
  test_simple_mlp_image:
    cmd: "python -m hateful_memes.models.simple_mlp_image --fast_dev_run True --log_dir\
      \ logs/test_simple_mlp_image_metrics --project test && echo \"PASSED\" > logs/test_simple_mlp_image.log\
      \ \n"
    deps:
    - path: data/01_raw/hateful_memes
      md5: 8844b5201ff55743fcd36c40d7352a88.dir
      size: 4232567214
      nfiles: 12148
    - path: hateful_memes/models/base.py
      md5: d220bbab0083a6d96e8089a2d8027c8d
      size: 6457
    - path: hateful_memes/models/simple_mlp_image.py
      md5: 1fe890458ac921cabd5f9250456a1bb7
      size: 2713
    outs:
    - path: logs/test_simple_mlp_image.log
      md5: 15de982d1dc99ce52d089868a579de34
      size: 7
  simple_mlp_image:
    cmd: "python -m hateful_memes.models.simple_mlp_image --batch_size 0 --lr 1e-05\
      \ --epochs 100 --dense_dim 128 --dropout_rate 0.1 --grad_clip 1.0 --model_dir\
      \ data/06_models/simple_mlp_image\n"
    deps:
    - path: data/01_raw/hateful_memes
      md5: 8844b5201ff55743fcd36c40d7352a88.dir
      size: 4232567214
      nfiles: 12148
    - path: hateful_memes/models/base.py
      md5: d220bbab0083a6d96e8089a2d8027c8d
      size: 6457
    - path: hateful_memes/models/simple_mlp_image.py
      md5: 1fe890458ac921cabd5f9250456a1bb7
      size: 2713
    - path: logs/test_simple_mlp_image.log
      md5: 15de982d1dc99ce52d089868a579de34
      size: 7
    outs:
    - path: data/06_models/simple_mlp_image
      md5: ba45eb0102f755386735b2de949e8e7b.dir
      size: 231635489
      nfiles: 1
  baseline:
    cmd: python -m hateful_memes.models.baseline_algorithm
    deps:
    - path: data/01_raw/hateful_memes
      md5: edc9355e84fe557ba8b0f8efa4b15b91.dir
      size: 4232567214
      nfiles: 12148
    - path: hateful_memes/models/baseline_algorithm.py
      md5: 5b5bbee254ba72de45450417e2b0efc5
      size: 2214
  visual_bert:
    cmd: "python -m hateful_memes.models.visual_bert --batch_size 0 --lr 1e-05 --epochs\
      \ 1000 --max_length 128 --dense_dim 256 --dropout_rate 0.0 --grad_clip 1.0 --model_dir\
      \ data/06_models/visual_bert --freeze false\n"
    deps:
    - path: data/01_raw/hateful_memes
      md5: 8844b5201ff55743fcd36c40d7352a88.dir
      size: 4232567214
      nfiles: 12148
    - path: hateful_memes/models/base.py
      md5: d220bbab0083a6d96e8089a2d8027c8d
      size: 6457
    - path: hateful_memes/models/visual_bert.py
      md5: 4b730bb0fda6de7d937a22e5fccb9691
      size: 4658
    - path: logs/test_visual_bert.log
      md5: 15de982d1dc99ce52d089868a579de34
      size: 7
    outs:
    - path: data/06_models/visual_bert
      md5: 730c755fcf0aa0e79c2bc7ccc1cca621.dir
      size: 1623293991
      nfiles: 1
  simple_text:
    cmd: "python -m hateful_memes.models.simple_text --batch_size 0 --lr 1e-05 --num_layers\
      \ 2 --embed_dim 256 --dense_dim 128 --max_length 512 --tokenizer_name bert-base-uncased\
      \ --grad_clip 1.0 --dropout_rate 0.1 --epochs 100 --model_dir data/06_models/simple_text\n"
    deps:
    - path: data/01_raw/hateful_memes
      md5: 8844b5201ff55743fcd36c40d7352a88.dir
      size: 4232567214
      nfiles: 12148
    - path: hateful_memes/models/base.py
      md5: d220bbab0083a6d96e8089a2d8027c8d
      size: 6457
    - path: hateful_memes/models/simple_text.py
      md5: c6ae787ee51bde9d42058fff700b3470
      size: 3914
    - path: logs/test_simple_text.log
      md5: 15de982d1dc99ce52d089868a579de34
      size: 7
    outs:
    - path: data/06_models/simple_text
      md5: 30aa0c34d1c74a4ed3f0a69d578a9161.dir
      size: 97934527
      nfiles: 1
  test_simple_text:
    cmd: "python -m hateful_memes.models.simple_text --fast_dev_run True && echo \"\
      PASSED\" > logs/test_simple_text.log\n"
    deps:
    - path: data/01_raw/hateful_memes
      md5: 8844b5201ff55743fcd36c40d7352a88.dir
      size: 4232567214
      nfiles: 12148
    - path: hateful_memes/models/base.py
      md5: d220bbab0083a6d96e8089a2d8027c8d
      size: 6457
    - path: hateful_memes/models/simple_text.py
      md5: c6ae787ee51bde9d42058fff700b3470
      size: 3914
    outs:
    - path: logs/test_simple_text.log
      md5: 15de982d1dc99ce52d089868a579de34
      size: 7
  test_super_model:
    cmd: "python -m hateful_memes.models.super_model --simple_image_chkpt data/06_models/simple_image\
      \ --simple_text_chkpt data/06_models/simple_text --fast_dev_run True && echo\
      \ \"PASSED\" > logs/test_super_model.log\n"
    deps:
    - path: data/01_raw/hateful_memes
      md5: 8844b5201ff55743fcd36c40d7352a88.dir
      size: 4232567214
      nfiles: 12148
    - path: data/06_models/simple_image
      md5: 67216ae5d938dcd9455b6bf47e8deb3d.dir
      size: 25186127
      nfiles: 1
    - path: data/06_models/simple_text
      md5: 30aa0c34d1c74a4ed3f0a69d578a9161.dir
      size: 97934527
      nfiles: 1
    - path: hateful_memes/models/base.py
      md5: d220bbab0083a6d96e8089a2d8027c8d
      size: 6457
    - path: hateful_memes/models/super_model.py
      md5: 5eab5caed5d8426190d96b09912a0ce2
      size: 5622
    outs:
    - path: logs/test_super_model.log
      md5: 15de982d1dc99ce52d089868a579de34
      size: 7
  super_model:
    cmd: "python -m hateful_memes.models.super_model --simple_image_chkpt data/06_models/simple_image\
      \ --simple_mlp_image_chkpt data/06_models/simple_mlp_image --simple_text_chkpt\
      \ data/06_models/simple_text --visual_bert_chkpt data/06_models/visual_bert\
      \ --vit_chkpt data/06_models/vit --beit_chkpt data/06_models/beit --batch_size\
      \ 0 --lr 1e-05 --num_dense_layers 2 --dense_dim 256 --dropout_rate 0.1 --epochs\
      \ 1000 --model_dir data/06_models/super_model\n"
    deps:
    - path: data/01_raw/hateful_memes
      md5: 8844b5201ff55743fcd36c40d7352a88.dir
      size: 4232567214
      nfiles: 12148
    - path: data/06_models/beit
      md5: e49693e2e41303df28e8685ed8710018.dir
      size: 439806739
      nfiles: 1
    - path: data/06_models/simple_image
      md5: 67216ae5d938dcd9455b6bf47e8deb3d.dir
      size: 25186127
      nfiles: 1
    - path: data/06_models/simple_mlp_image
      md5: ba45eb0102f755386735b2de949e8e7b.dir
      size: 231635489
      nfiles: 1
    - path: data/06_models/simple_text
      md5: 30aa0c34d1c74a4ed3f0a69d578a9161.dir
      size: 97934527
      nfiles: 1
    - path: data/06_models/visual_bert
      md5: 730c755fcf0aa0e79c2bc7ccc1cca621.dir
      size: 1623293991
      nfiles: 1
    - path: data/06_models/vit
      md5: 10bc754768b5c2b12ae1e9d9d4c2c08a.dir
      size: 372105881
      nfiles: 1
    - path: hateful_memes/models/base.py
      md5: d220bbab0083a6d96e8089a2d8027c8d
      size: 6457
    - path: hateful_memes/models/super_model.py
      md5: 5eab5caed5d8426190d96b09912a0ce2
      size: 5622
    - path: logs/test_super_model.log
      md5: 15de982d1dc99ce52d089868a579de34
      size: 7
    outs:
    - path: data/06_models/super_model
      md5: e061f76c6b9c3179b01c0576516fce96.dir
      size: 1441887672
      nfiles: 1
  test_vit:
    cmd: "python -m hateful_memes.models.baseIT --model_name vit --batch_size 4  --fast_dev_run\
      \ True --log_dir logs/test_simple_vit_image_metrics --project test && echo \"\
      PASSED\" > logs/test_vit.log\n"
    deps:
    - path: data/01_raw/hateful_memes
      md5: 8844b5201ff55743fcd36c40d7352a88.dir
      size: 4232567214
      nfiles: 12148
    - path: hateful_memes/models/baseIT.py
      md5: 8c25285a190968a3102d67fc3442c347
      size: 4559
    outs:
    - path: logs/test_vit.log
      md5: 15de982d1dc99ce52d089868a579de34
      size: 7
  vit:
    cmd: "python -m hateful_memes.models.baseIT --model_name vit --batch_size 0 --lr\
      \ 1e-05 --epochs 100 --max_length 256 --dense_dim 128 --dropout_rate 0.1 --grad_clip\
      \ 1.0 --model_dir data/06_models/vit\n"
    deps:
    - path: data/01_raw/hateful_memes
      md5: 8844b5201ff55743fcd36c40d7352a88.dir
      size: 4232567214
      nfiles: 12148
    - path: hateful_memes/models/baseIT.py
      md5: 8c25285a190968a3102d67fc3442c347
      size: 4559
    - path: logs/test_vit.log
      md5: 15de982d1dc99ce52d089868a579de34
      size: 7
    outs:
    - path: data/06_models/vit
      md5: 10bc754768b5c2b12ae1e9d9d4c2c08a.dir
      size: 372105881
      nfiles: 1
  test_beit:
    cmd: "python -m hateful_memes.models.baseIT --model_name vit --batch_size 4  --fast_dev_run\
      \ True --log_dir logs/test_simple_beit_image_metrics --project test && echo\
      \ \"PASSED\" > logs/test_beit.log\n"
    deps:
    - path: data/01_raw/hateful_memes
      md5: 8844b5201ff55743fcd36c40d7352a88.dir
      size: 4232567214
      nfiles: 12148
    - path: hateful_memes/models/baseIT.py
      md5: 8c25285a190968a3102d67fc3442c347
      size: 4559
    outs:
    - path: logs/test_beit.log
      md5: 15de982d1dc99ce52d089868a579de34
      size: 7
  beit:
    cmd: "python -m hateful_memes.models.baseIT --model_name beit --batch_size 0 --lr\
      \ 1e-05 --epochs 100 --max_length 256 --dense_dim 128 --dropout_rate 0.1 --grad_clip\
      \ 1.0 --model_dir data/06_models/beit\n"
    deps:
    - path: data/01_raw/hateful_memes
      md5: 8844b5201ff55743fcd36c40d7352a88.dir
      size: 4232567214
      nfiles: 12148
    - path: hateful_memes/models/baseIT.py
      md5: 8c25285a190968a3102d67fc3442c347
      size: 4559
    - path: logs/test_beit.log
      md5: 15de982d1dc99ce52d089868a579de34
      size: 7
    outs:
    - path: data/06_models/beit
      md5: e49693e2e41303df28e8685ed8710018.dir
      size: 439806739
      nfiles: 1
  test_electra:
    cmd: "python -m hateful_memes.models.auto_text_model --batch_size 4  --fast_dev_run\
      \ True --model_name google/electra-small-discriminator && echo \"PASSED\" >\
      \ logs/test_electra.log \n"
    deps:
    - path: data/01_raw/hateful_memes
      md5: 8844b5201ff55743fcd36c40d7352a88.dir
      size: 4232567214
      nfiles: 12148
    - path: hateful_memes/models/auto_text_model.py
      md5: 579f641133a57c00135d00872fc0098c
      size: 3089
    outs:
    - path: logs/test_electra.log
      md5: 15de982d1dc99ce52d089868a579de34
      size: 7
  electra:
    cmd: "python -m hateful_memes.models.auto_text_model --batch_size 0 --lr 1e-05\
      \ --epochs 100 --max_length 256 --dense_dim 256 --dropout_rate 0.1 --grad_clip\
      \ 1.0 --model_name google/electra-small-discriminator --project electra --model_dir\
      \ data/06_models/electra\n"
    deps:
    - path: data/01_raw/hateful_memes
      md5: 8844b5201ff55743fcd36c40d7352a88.dir
      size: 4232567214
      nfiles: 12148
    - path: hateful_memes/models/auto_text_model.py
      md5: 579f641133a57c00135d00872fc0098c
      size: 3089
    - path: logs/test_electra.log
      md5: 15de982d1dc99ce52d089868a579de34
      size: 7
    outs:
    - path: data/06_models/electra
      md5: 76a445fbe7d4b62b5a9b81b683a4e649.dir
      size: 363339833
      nfiles: 1
  test_distilbert:
    cmd: "python -m hateful_memes.models.auto_text_model --batch_size 4  --fast_dev_run\
      \ True --model_name distilbert-base-uncased-finetuned-sst-2-english && echo\
      \ \"PASSED\" > logs/test_distilbert.log \n"
    deps:
    - path: data/01_raw/hateful_memes
      md5: 8844b5201ff55743fcd36c40d7352a88.dir
      size: 4232567214
      nfiles: 12148
    - path: hateful_memes/models/auto_text_model.py
      md5: 579f641133a57c00135d00872fc0098c
      size: 3089
    outs:
    - path: logs/test_distilbert.log
      md5: 15de982d1dc99ce52d089868a579de34
      size: 7
  distilbert:
    cmd: "python -m hateful_memes.models.auto_text_model --batch_size 0 --lr 1e-05\
      \ --epochs 100 --max_length 256 --dense_dim 256 --dropout_rate 0.1 --grad_clip\
      \ 1.0 --model_name distilbert-base-uncased-finetuned-sst-2-english --project\
      \ distilbert --model_dir data/06_models/distilbert\n"
    deps:
    - path: data/01_raw/hateful_memes
      md5: 8844b5201ff55743fcd36c40d7352a88.dir
      size: 4232567214
      nfiles: 12148
    - path: hateful_memes/models/auto_text_model.py
      md5: 579f641133a57c00135d00872fc0098c
      size: 3089
    - path: logs/test_distilbert.log
      md5: 15de982d1dc99ce52d089868a579de34
      size: 7
    outs:
    - path: data/06_models/distilbert
      md5: 3e4db949d33049e4c5919b043cd2c39e.dir
      size: 1400446221
      nfiles: 1
  hateful_memes_to_snli_ve:
    cmd: python hateful_memes/data/hateful_memes_snli_ve.py
    deps:
    - path: data/01_raw/hateful_memes
      md5: 33e8a3b59cb044f3893d27962a127805.dir
      size: 4232397658
      nfiles: 12148
    - path: hateful_memes/data/hateful_memes_snli_ve.py
      md5: b99996b91149bb58162e3e49ca1d8843
      size: 4483
    outs:
    - path: data/02_intermediate/hateful_memes_train_snli_ve.tsv
      md5: cfdac03de35580554bd8f3d3dfc8a120
      size: 4077445020
    - path: data/02_intermediate/hateful_memes_valid_snli_ve.tsv
      md5: e53d1c118761446cd00d926469da82f5
      size: 252275396
  test_hateful_ofa:
    cmd: "python -m hateful_memes.models.hateful_ofa data/02_intermediate/hateful_memes_train_snli_ve.tsv,data/02_intermediate/hateful_memes_valid_snli_ve.tsv\
      \ --selected-cols 0,2,3,4,5 --restore-file data/06_models/ofa/snli_ve_large_best.pt\
      \ --save-dir data/06_models/hateful_ofa --task snli_ve  --arch ofa_large --batch-size\
      \ 1 --encoder-normalize-before --decoder-normalize-before --share-decoder-input-output-embed\
      \ --share-all-embeddings --layernorm-embedding  --patch-layernorm-embedding\
      \ --code-layernorm-embedding  --resnet-drop-path-rate 0.0  --encoder-drop-path-rate\
      \ 0.2 --decoder-drop-path-rate 0.2 --dropout 0.1  --attention-dropout 0.0 --weight-decay\
      \ 0.01  --optimizer adam  --adam-betas 0.9,0.999 --adam-eps 1e-08 --clip-norm\
      \ 1.0 --lr 2e-05  --max-epoch 6  --fixed-validation-seed 7  --max-src-length\
      \ 80 --max-tgt-length 20 --find-unused-parameters  --add-type-embedding  --scale-attn\
      \  --scale-fc  --scale-heads  --disable-entangle  --num-bins 1000 --patch-image-size\
      \ 480 --prompt-type prev_output  --add-caption  --fp16  --fp16-scale-window\
      \ 512 --num-workers 0 --ema-alpha 0.1 --fast-dev-run 1 --monitor-metric val/loss\
      \ --monitor-metric-mode min --stopping-patience 10 && echo \"PASSED\" > logs/test_hateful_ofa.log\n"
    deps:
    - path: data/02_intermediate/hateful_memes_train_snli_ve.tsv
      md5: a4aa96507523cfab3af40019c2020f8a
      size: 4077674756
    - path: data/02_intermediate/hateful_memes_valid_snli_ve.tsv
      md5: e53d1c118761446cd00d926469da82f5
      size: 252275396
    - path: data/06_models/ofa/snli_ve_large_best.pt
      md5: 8368190a42477d2974fa0affb6279f00
      size: 6230613509
    - path: hateful_memes/models/hateful_ofa.py
      md5: c8b090fb1e513163c02ef911d13bbd64
      size: 13459
    outs:
    - path: logs/test_hateful_ofa.log
      md5: 15de982d1dc99ce52d089868a579de34
      size: 7
  train_hateful_ofa:
    cmd: "python -m hateful_memes.models.hateful_ofa data/02_intermediate/hateful_memes_train_snli_ve.tsv,data/02_intermediate/hateful_memes_valid_snli_ve.tsv\
      \ --selected-cols 0,2,3,4,5 --restore-file data/06_models/ofa/snli_ve_large_best.pt\
      \ --save-dir data/06_models/hateful_ofa --task snli_ve  --arch ofa_large --batch-size\
      \ 4 --encoder-normalize-before --decoder-normalize-before --share-decoder-input-output-embed\
      \ --share-all-embeddings --layernorm-embedding  --patch-layernorm-embedding\
      \ --code-layernorm-embedding  --resnet-drop-path-rate 0.0  --encoder-drop-path-rate\
      \ 0.2 --decoder-drop-path-rate 0.2 --dropout 0.1  --attention-dropout 0.0 --weight-decay\
      \ 0.01  --optimizer adam  --adam-betas 0.9,0.999 --adam-eps 1e-08 --clip-norm\
      \ 1.0 --lr 2e-05  --max-epoch 6  --fixed-validation-seed 7  --max-src-length\
      \ 80 --max-tgt-length 20 --find-unused-parameters  --add-type-embedding  --scale-attn\
      \  --scale-fc  --scale-heads  --disable-entangle  --num-bins 1000 --patch-image-size\
      \ 480 --prompt-type prev_output  --add-caption  --fp16  --fp16-scale-window\
      \ 512 --num-workers 8 --ema-alpha 0.1 --fast-dev-run 0 --monitor-metric val/loss\
      \ --monitor-metric-mode min --stopping-patience 10\n"
    deps:
    - path: data/02_intermediate/hateful_memes_train_snli_ve.tsv
      md5: cfdac03de35580554bd8f3d3dfc8a120
      size: 4077445020
    - path: data/02_intermediate/hateful_memes_valid_snli_ve.tsv
      md5: e53d1c118761446cd00d926469da82f5
      size: 252275396
    - path: data/06_models/ofa/snli_ve_large_best.pt
      md5: 8368190a42477d2974fa0affb6279f00
      size: 6230613509
    - path: hateful_memes/models/hateful_ofa.py
      md5: acd887a991eff16f3996c06b9a95d61c
      size: 13475
    outs:
    - path: data/06_models/hateful_ofa
      md5: d751713988987e9331980363e24189ce.dir
      size: 0
      nfiles: 0
